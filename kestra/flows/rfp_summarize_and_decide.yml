id: rfp_summarize_and_decide
namespace: hackathon.ai
inputs:
  - id: backend_url
    type: STRING
    defaults: "http://host.docker.internal:8000"  # use host.docker.internal when running Docker on Windows
tasks:
  - id: fetch_rfp
    type: io.kestra.plugin.http.Request
    uri: "{{ inputs.backend_url }}/rfp/full-run"
    method: GET
    # expect JSON response

  - id: summarize_and_decide
    type: io.kestra.plugin.ai.agent.AIAgent
    systemMessage: |
      You are an analytical procurement assistant for an EPC/utility company.
      Read the JSON input from the previous task (rfp analysis) and provide:
      1) A 5-line human-friendly summary highlighting: key specs, major risks, top cost drivers.
      2) A recommendation: "GO" if match quality is high and cost is acceptable, otherwise "NO-GO".
      3) A short justification for the recommendation (1-2 lines).
      Output JSON must include fields: summary, decision, justification, total_cost.
    inputs:
      - id: rfp_json
        type: STRING
        defaults: "{{ tasks.fetch_rfp.response.body }}"
    # plugin defaults set below for provider (example uses OpenAI-like provider)
pluginDefaults:
  - type: io.kestra.plugin.ai.agent.AIAgent
    values:
      provider:
        type: io.kestra.plugin.ai.provider.OpenAI
        apiKey: "{{ secret('OPENAI_API_KEY') }}"
        modelName: gpt-4o
        configuration:
          responseFormat:
            type: JSON
            # define expected keys (summary, decision, justification, total_cost)
